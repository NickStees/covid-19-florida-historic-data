<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Historical COVID-19 Data</title>
	<meta name="description" content="COVID-19 Florida historical data">
	<meta name="keywords" content="COVID-19 Florida, historical">
	<link rel="icon" type="image/x-icon" href="favicon.ico">
  <link rel="stylesheet" href="https://www.tampagov.net/static/css/styles.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.js"></script>
  <!-- <script src="http://tampagov.net/static/js/bundle.min.js"></script> -->

<!-- Vue -->
<script src="https://cdn.jsdelivr.net/npm/vue@2.5.16/dist/vue.js"></script>

<!-- lodash for working with data -->
<script src="https://cdn.jsdelivr.net/npm/lodash@4.17.10/lodash.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
  <style>
    #app{ }
    .ranking {
      height: 32px;
      min-width: 1%;
      display: inline-block;
    }
    .count {
      min-width: 30px;
      padding-right: 5px;
      display: inline-block;
      font-weight: bold;
      text-align: right;
      font-size: 18px;
    }
    .rank-list{
      max-height: 376px;
      overflow-y: auto;
      overflow-x: hidden;
      padding: 1rem 2rem;
    }
    .rank-list .item {
      padding: 5px 0;
    }
    .rank-list .item:nth-child(1) .teamname {
      font-size: 150%;
      font-weight: 700;
    }
    .rank-list .item:nth-child(2) .teamname {
      font-size: 120%;
      font-weight: 600;
    }
    .item.HILLSBOROUGH{
      border: dashed 3px #0072bc;
    }
    </style>
  </head>
  <body>
    <div class="content">
      <div class="header">
        <div class="chartjs-title">Historical Covid-19 Data</div>
        <div class="chartjs-caption">
          Covid-19 Data 30 days
        </div>
      </div>

      <div id="app" v-cloak>
        <div v-if="hillsborough">
          <div class="row">
            <div class="col-sm-4 text-center" >
              <div class="text-primary fa-3x"><strong>{{hillsborough.attributes.Count_TOTAL}}</strong></div>
              <strong>Hillsborough Cases</strong>
              <hr>
              Age Range: <strong>{{hillsborough.attributes.AgeRange}}</strong><br>
              Men: <strong>{{hillsborough.attributes.Men}}</strong> | Women: <strong>{{hillsborough.attributes.Women}}</strong><br>
              <hr>
              <a class="btn btn-primary btn-block" href="https://fdoh.maps.arcgis.com/apps/opsdashboard/index.html#/8d0de33f260d444c852a615dc7837c86">Florida's COVID-19 map</a>
            </div>
            <div class="col-sm-8" >
              <div class="text-center"><strong>Top Cases by Florida County</strong></div>
              <div class="rank-list">
                <div class="row item" v-for="county in flCounties" :class="county.attributes.COUNTYNAME" >
                  <div class="col-xs-6 text-right">
                    <span class="countyname">{{ county.attributes.County_1 }}</span>
                  </div>
                  <div class="col-xs-6 flex flex-row">
                    <span class="count">
                      {{ county.attributes.Count_TOTAL }}
                    </span>
                    <span
                      class="ranking background-primary"
                      :style="{ width: (county.attributes.Count_TOTAL / casesSummary.max) * 100 + '%' }"
                    ></span>
                  </div>

                </div>
              </div>
            </div>
          </div>

        </div>
      </div>

      <canvas id="myChart"></canvas>
    </div>


    <script src="main.js"></script>
    <script>

      var app = new Vue({
        el: '#app',
        data: {
          flCounties: [],
        },
        mounted: function () {
          // get info
          var self = this;
          jQuery.getJSON( "https://services1.arcgis.com/CY1LXxl9zlJeBuRZ/arcgis/rest/services/Florida_COVID19_Cases/FeatureServer/0/query?f=json&where=Counts%20IS%20NOT%20NULL&returnGeometry=false&spatialRel=esriSpatialRelIntersects&outFields=*&orderByFields=Count_TOTAL%20desc&resultOffset=0&resultRecordCount=67&cacheHint=true", function( data ) {
             self.flCounties =  data.features
          });
        },
        computed: {
          hillsborough: function hillsborough() {
            var matches =  _.filter(this.flCounties, { 'attributes': { COUNTYN: 57 } });
            return matches[0];
          },
          casesSummary: function casesSummary() {
            return {
              min: this.flCounties[this.flCounties.length - 1].attributes.Count_TOTAL,
              max: this.flCounties[0].attributes.Count_TOTAL,
            };
          }
        },
      })
      </script>
  </body>
</html>
